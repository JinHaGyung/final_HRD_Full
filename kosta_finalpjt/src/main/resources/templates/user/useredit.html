<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript">
window.onload = () => {
	if('[[${session.type }]]' == '[[admin]]') {
		document.getElementById('idid').readOnly = false;
		document.getElementById('usernmid').readOnly = false;
		document.getElementById('typeid').readOnly = false;
	}
	
}

const aprovbtn = (userid, aprov) => {
	const req = new XMLHttpRequest();
	let txt1 = '';
	let txt2 = '';
	req.onload = () => {
		let obj = JSON.parse(req.responseText);
		if(obj.aprov == 1) {
			txt1 = '재직상태';
			txt2 = '휴직처리';
		} else if(obj.aprov == 2) {
			txt1 = '휴직상태';
			txt2 = '승인처리';
		} else if(obj.aprov == 3) {
			txt1 = '퇴직상태';
			txt2 = '승인처리';
		}
	document.getElementById('aprovid').innerHTML = txt1;
	document.getElementById('aprovbtnid1').value = txt2;
	}
	alert(userid + '의 승인 상태가 변경되었습니다.');
	req.open('get', '/admin/user/useraprov?id=' + userid + '&aprov=' + aprov);
	req.send();
}

const levaprovbtn = (userid) => {
	location.href = '/admin/user/useraprov?id=' + userid + '&aprov=2';
}

const caclaprovbtn = (userid) => {
	location.href = '/admin/user/useraprov?id=' + userid + '&aprov=3';
}


const home = (type) => {
	if (type == 'admin') {
		location.href='/index_admin';
	} else if (type == 'emp') {
		location.href='/index_emp';
	} else {
		location.href='/';
	}
}

const resetbtn = () => {
	document.getElementById('idid').value = '[[${user.id }]]';
	document.getElementById('usernmid').value = '[[${user.usernm }]]';
	document.getElementById('pwdid').value = '[[${user.pwd }]]';
	document.getElementById('typeid').value = '[[${user.type }]]';
}

</script>
</head>
<body>
<h3>내 로그인 정보 수정 페이지</h3>
<form th:action="@{/user/useredit }" method="post" name='useref'>
<table border="1">
<tr><th>사용자 계정</th><td><input type="text" name="id" id="idid" th:value="${user.id }" readonly></td></tr>
<tr><th>사용자 이름</th><td><input type="text" name="usernm" id="usernmid" th:value="${user.usernm }" readonly></td></tr>
<tr><th>사용자 비밀번호</th><td><input type="password" name="pwd" id="pwdid" th:value="${user.pwd }"></td></tr>
<tr><th>사용자 유형</th><td><input type="text" name="type" id="typeid" th:value="${user.type }" readonly></td></tr>
<tr><th>사용자 승인 상태</th>
<td th:text="${aprovStr }" name="aprovStr" id="aprovid"></td>
<td th:if="${session.type == 'admin' }">
	<input type="button" id="aprovbtnid1" th:if="${user.aprov } == 0 or ${user.aprov } == 2 or ${user.aprov } == 3" value="승인처리" th:onclick="aprovbtn([[${user.id}]], '1')">
	<input type="button" th:if="${user.aprov } == 1" value="휴직처리" th:onclick="aprovbtn([[${user.id}]], '2')">
	<input type="button" value="퇴사처리" th:onclick="aprovbtn([[${user.id}]], '3')">
</td>
</tr>
</table>
<div th:if="${session.loginId == user.id } or ${session.type == 'admin' }">
<input id="usereditid" type="submit" value="내로그인정보수정버튼"><br/>
</div>
</form>
<input type="reset" value="취소하기" th:onclick="resetbtn()"><br/>
<input type="button" value="뒤로가기버튼" onclick="history.back()"><br/>
<input type="button" value="홈버튼" th:onclick="home([[${session.type }]])"><br/>
</body>
</html>