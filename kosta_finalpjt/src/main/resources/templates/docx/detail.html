<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" th:href="@{/css/common/reset.css}">
    <link rel="stylesheet" th:href="@{/css/common/leftnav.css}">
    <link rel="stylesheet" th:href="@{/css/common/header.css}">
    <link rel="stylesheet" th:href="@{/css/record.css}">
    <script src="https://kit.fontawesome.com/de9b677ac7.js" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script type="text/javascript">
        const approveDocx = (docxkey, formtype) => {
            const form = document.createElement('form');
            form.method = 'post';
            form.action = '/auth/docx/approve';

            const docxkeyInput = document.createElement('input');
            docxkeyInput.type = 'hidden';
            docxkeyInput.name = 'docxkey';
            docxkeyInput.value = docxkey;
            form.appendChild(docxkeyInput);

            const formtypeInput = document.createElement('input');
            formtypeInput.type = 'hidden';
            formtypeInput.name = 'formtype';
            formtypeInput.value = formtype;
            form.appendChild(formtypeInput);

            document.body.appendChild(form);
            form.submit();
        };

        document.addEventListener("DOMContentLoaded", function () {
            const buttons = document.querySelectorAll('button[data-docxkey][data-formtype]');
            buttons.forEach(button => {
                button.addEventListener('click', function () {

                    const docxkey = parseInt(this.getAttribute('data-docxkey'), 10);
                    const formtype = this.getAttribute('data-formtype');
                    if (!isNaN(docxkey)) {
                        approveDocx(docxkey, formtype);
                    } else {
                        console.error('Invalid data attributes:', { docxkey, formtype });
                    }
                });
            });
        });
    </script>
</head>

<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-12 text-center">
                <h3 class="font_b24 m_b2">문서 상세 페이지</h3>
            </div>
        </div>
        <div class="record_table w_bg">
            <div class="row">
                <div class="col-12">
                    <div class="mb-3">
                        <strong>문서 제목:</strong> <span th:text="${d.title}" aria-readonly="true"></span>
                    </div>
                    <div class="mb-3">
                        <strong>작성자:</strong> <span th:text="${d.writer.id}" aria-readonly="true"></span>
                    </div>
                    <div class="mb-3">
                        <strong>기한:</strong> <span th:text="${d.enddt}" aria-readonly="true"></span>
                    </div>
                    <div class="mb-3">
                        <strong>업무 계획:</strong> <span th:text="${d.taskplan}" aria-readonly="true"></span>
                    </div>
                    <div class="mb-3">
                        <strong>업무 진행 과정:</strong> <span th:text="${d.taskprocs}" aria-readonly="true"></span>
                    </div>
                    <div class="mb-3">
                        <strong>결재 현황:</strong> <span th:text="${d.status}" aria-readonly="true" id="status"></span>
                    </div>
                    <div class="mb-3">
                        <strong>결재 권한:</strong>
                        <ul class="list-unstyled">
                            <li th:each="senior : ${docx}" th:text="${senior.senior}"></li>
                        </ul>
                    </div>
                    <div class="mb-3">
                        <strong>결재 순서:</strong> <span th:text="${d.docxorder}" aria-readonly="true"></span>
                    </div>
                    <div class="mb-3">
                        <strong>결재 위치:</strong> <span th:text="${d.orderloc}" aria-readonly="true"></span>
                    </div>
                    <div>
                        <button type="button" class="btn btn-primary" th:if="${flag}" data-docxkey="${docx[0].docxkey}"
                            data-formtype="${docx[0].formtype}" th:onclick="approveDocx([[${docx[0].docxkey}]], [[${docx[0].formtype}]])">결재</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-12 text-center">
                <a href="/auth/docx/list" class="btn btn-secondary">문서 리스트로 돌아가기</a>
            </div>
        </div>
    </div>
</body>

</html>